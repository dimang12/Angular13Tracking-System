rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Only authenticated users can read/write daily reports.
    match /dailyReports/{reportId} {
      // Allow read to authenticated users
      allow get, list: if request.auth != null;

      // Allow create only if the request contains a userId that matches the authenticated user
      allow create: if request.auth != null && request.resource.data.userId == request.auth.uid;

      // Allow update and delete only if the existing document owner matches the authenticated user
      allow update, delete: if request.auth != null && resource.data.userId == request.auth.uid;
    }

    // Projects collection: allow authenticated reads; writes require auth (and optionally ownership checks)
    match /projects/{projectId} {
      allow get, list: if request.auth != null;
      allow create: if request.auth != null && request.resource.data.ownerId == request.auth.uid;
      allow update, delete: if request.auth != null && resource.data.ownerId == request.auth.uid;
    }

    // Tasks collection: allow authenticated reads; create/update/delete require authentication and a user association
    match /tasks/{taskId} {
      allow get, list: if request.auth != null;
      allow create: if request.auth != null && (request.resource.data.creator == request.auth.uid || request.resource.data.assignee == request.auth.uid);
      allow update, delete: if request.auth != null && (resource.data.creator == request.auth.uid || resource.data.assignee == request.auth.uid);
    }

    // Comments collection: allow authenticated reads/writes, restrict updates/deletes to comment owner
    match /comments/{commentId} {
      allow get, list, create: if request.auth != null;
      allow update, delete: if request.auth != null && resource.data.userId == request.auth.uid;
    }

    // Project groups: allow authenticated reads; writes limited to authenticated users
    match /project-groups/{groupId} {
      allow get, list: if request.auth != null;
      allow create: if request.auth != null;
      allow update, delete: if request.auth != null;
    }

    // Deny all other access by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
